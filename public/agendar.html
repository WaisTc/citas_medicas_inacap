<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sistema de Agendamiento</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="https://kit.fontawesome.com/0b464b9606.js" crossorigin="anonymous"></script>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary" style="min-width: 100%;">
    <div class="container">
      <a class="navbar-brand" href="#">Shuby Agends</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Inicio</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Contacto</a></li>
          <li class="nav-item" id="citasUser_"><a class="nav-link" href="citasUser.html">Mis Citas</a></li>
        </ul>
      </div>

      <!-- Botones de usuario -->
      <button class="user-button" id="user-button-ql" onclick="botonQ()">
        <i class="fa-solid fa-user"></i>
      </button>
      
      <button class="user-button" style="background: green;" id="perfil">
        <i class="fa-solid fa-user"></i>
      </button>
      
      <span id="user-email" class="ms-2 text-white" style="display: none;"></span>

    </div>
  </nav>

  <!-- agendar cita  -->

  <div class="container mt-5">
    <div class="card shadow-lg border-0">
      <div class="card-header bg-primary text-white">
        <h2 class="mb-0"><i class="bi bi-person-lines-fill"></i> Datos del paciente</h2>
      </div>
      <div class="card-body">
        <form id="paciente-form" method="post">
          
          <!-- RUT -->
          <div class="mb-3">
            <label for="rut" class="form-label"><i class="bi bi-card-text"></i> RUT</label>
            <input type="text" class="form-control" id="rut" name="rut" placeholder="Ej: 12.345.678-9" required>
          </div>

          <!-- Nombres -->
          <div class="mb-3">
            <label for="nombres" class="form-label"><i class="bi bi-person"></i> Nombres</label>
            <input type="text" class="form-control" id="nombres" name="nombres" placeholder="Ingrese nombres" required>
          </div>

          <!-- Apellidos -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="primer_apellido" class="form-label">Primer Apellido</label>
              <input type="text" class="form-control" id="primer_apellido" name="primer_apellido" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="segundo_apellido" class="form-label">Segundo Apellido</label>
              <input type="text" class="form-control" id="segundo_apellido" name="segundo_apellido">
            </div>
          </div>

          <!-- Contacto -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="correo" class="form-label"><i class="bi bi-envelope"></i> Correo</label>
              <input type="email" class="form-control" id="correo" name="correo" placeholder="ejemplo@correo.com">
            </div>
            <div class="col-md-6 mb-3">
              <label for="telefono" class="form-label"><i class="bi bi-telephone"></i> Teléfono</label>
              <input type="text" class="form-control" id="telefono" name="telefono" placeholder="+56 9 1234 5678">
            </div>
          </div>

          <!-- Dirección -->
          <div class="mb-3">
            <label for="direccion" class="form-label"><i class="bi bi-house"></i> Dirección</label>
            <input type="text" class="form-control" id="direccion" name="direccion" placeholder="Ingrese dirección">
          </div>

          <!-- Fecha de nacimiento -->
          <div class="mb-3">
            <label for="fecha_nacimiento" class="form-label"><i class="bi bi-calendar-date"></i> Fecha de Nacimiento</label>
            <input type="date" class="form-control" id="fecha_nacimiento" name="fecha_nacimiento">
          </div>

          <!-- Plan de salud -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="plan_salud_nombre" class="form-label">Plan de Salud</label>
              <input type="text" class="form-control" id="plan_salud_nombre" name="plan_salud_nombre">
            </div>
            <div class="col-md-6 mb-3">
              <label for="plan_salud_tipo" class="form-label">Tipo de Plan</label>
              <input type="text" class="form-control" id="plan_salud_tipo" name="plan_salud_tipo">
            </div>
          </div>

          <!-- Doctor -->
          <div class="mb-3">
            <label for="doctor_select" class="form-label"><i class="bi bi-person-badge"></i> Doctor</label>
            <select id="doctor_select" name="doctor" class="form-select">
              <option value="">Selecciona</option>
            </select>
          </div>

          <!-- Botón -->
          <div class="text-center">
            <button type="submit" class="btn btn-success btn-lg">
              <i class="bi bi-check-circle"></i> Confirmar
            </button>
          </div>

        </form>
      </div>
    </div>
  </div>


  <div class="pantalla"></div>


  <!-- Footer -->
  <footer class="bg-dark text-white pt-4 pb-2 mt-5" style="width: 100%; bottom: 0px;">
    <div class="container text-center text-md-start" >
      <div class="row">
        <div class="col-md-6 mb-3" >
          <h5>AgendApp</h5>
          <p>Proyecto universitario desarrollado por Allan y Javier.</p>
        </div>
        <div class="col-md-6 text-md-end">
          <a href="#" class="text-white me-3"><i class="bi bi-facebook"></i></a>
          <a href="#" class="text-white me-3"><i class="bi bi-instagram"></i></a>
          <a href="#" class="text-white"><i class="bi bi-envelope-fill"></i></a>
        </div>
      </div>
      <hr class="bg-light">
      <div class="text-center">
        <p class="mb-0">&copy; 2025 Todos los derechos reservados</p>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="agendar.js"></script>
  <script>
    const token = sessionStorage.getItem('token');
    const rol = sessionStorage.getItem('rol')

    if(rol == 2){
      alert("Usuario no permitido")
      window.location.href = 'index.html'; // Redirige al index
    }


    if (token) {
      // Desabilitar boton inicio de sesion
      document.getElementById('user-button-ql').style.display = 'none';
      // Cerrar sesion
      document.getElementById('perfil').addEventListener('click', () => {
        sessionStorage.removeItem('token'); // Elimina el token
        sessionStorage.removeItem('correo_user'); // Elimina el token
        sessionStorage.removeItem('rol');
        alert("Cerrando sesion")
        window.location.href = 'index.html'; // Redirige al index
      });
    }
    else{
      alert("Debe iniciar sesion primero")
      window.location.href = 'index.html'; // Redirige al index
    }
  </script>

    <script>
    fetch('http://localhost:3000/api/usuario/medicos')
        .then(response => {
        if (!response.ok) throw new Error('Error en la respuesta del servidor');
        return response.json();
        })
        .then(data => {
        const select = document.getElementById('doctor_select');

        
        data.medic.forEach(({ rut_empleado, nombres }) => {
          const option = document.createElement('option');
          option.value = rut_empleado;
          option.textContent = nombres;
          select.appendChild(option);
        });

        })
        .catch(error => {
        console.error('Error al cargar doctores:', error);
        });
    </script>

    

    <script>
        const c = sessionStorage.getItem("correo_user");
        if (c) {
            fetch(`http://localhost:3000/api/usuario/paciente_datos/${c}`)
                .then(res => {
                    if (!res.ok) throw new Error("No se pudo obtener los datos");
                    return res.json();
                })
                .then(data => {
                    document.getElementById("rut").value = data.rut_paciente || "";
                    document.getElementById("nombres").value = data.nombres || "";
                    document.getElementById("segundo_apellido").value = data.segundo_apellido || "";
                    document.getElementById("primer_apellido").value = data.primer_apellido || "";
                    document.getElementById("correo").value = data.correo || "";
                    document.getElementById("telefono").value = data.telefono || "";
                    document.getElementById("direccion").value = data.direccion || "";
                    
                    const fechaCruda = data.fecha_nacimiento;
                    const fechaFormateada = fechaCruda.split('T')[0];
                    document.getElementById("fecha_nacimiento").value = fechaFormateada;


                    document.getElementById("plan_salud_nombre").value = data.plan_salud_nombre || "";
                    document.getElementById("plan_salud_tipo").value = data.plan_salud_tipo || "";
                })
                .catch(err => console.error("Error al cargar datos del usuario:", err));
        }
    </script>

  <script>

    const userMail = sessionStorage.getItem('correo_user')

    const mailSpan = document.getElementById("user-email");

    if (userMail) {
      mailSpan.textContent = userMail;
      mailSpan.style.display = "inline"; // mostrar
    } else {
      mailSpan.style.display = "none"; // ocultar
    }
  </script>


    


  </body>
</html>
